services:
  eureka-server:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: eureka-server
    container_name: eureka-server
    restart: unless-stopped
    environment:
      - SERVER_PORT=8761
    networks:
      - skilledup

  api-gateway:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: api-gateway
    container_name: api-gateway
    restart: unless-stopped
    depends_on:
      - eureka-server
    ports:
      - "8080:8080"
    environment:
      - SERVER_PORT=8080
      - EUREKA_SERVER_URL=http://eureka-server:8761/eureka/
      - AUTH_SERVICE_URI=http://auth-service:8081
      - STUDENT_SERVICE_URI=http://student-service:8082
      - CERTIFICATE_SERVICE_URI=http://certificate-service:8083
      - TASK_SERVICE_URI=http://task-service:8084
      - NOTIFICATION_SERVICE_URI=http://notification-service:8085
      - SUPPORT_SERVICE_URI=http://support-service:8086
      - COURSE_SERVICE_URI=http://course-service:8090
      - PAYMENT_SERVICE_URI=http://payment-service:8091
      - CAREER_SERVICE_URI=http://career-service:8093
    networks:
      - skilledup

  auth-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: auth-service
    container_name: auth-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8081
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${AUTH_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
    networks:
      - skilledup

  student-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: student-service
    container_name: student-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8082
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${STUDENT_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - CLOUD_AWS_REGION_STATIC=${AWS_REGION}
      - CLOUD_AWS_S3_BUCKET=${AWS_BUCKET}
      - CLOUD_AWS_CREDENTIALS_ACCESS_KEY=${AWS_ACCESS_KEY_ID}
      - CLOUD_AWS_CREDENTIALS_SECRET_KEY=${AWS_SECRET_ACCESS_KEY}
    networks:
      - skilledup

  certificate-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: certificate-service
    container_name: certificate-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8083
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${CERTIFICATE_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - CLOUD_AWS_REGION_STATIC=${AWS_REGION}
      - CLOUD_AWS_S3_BUCKET=${AWS_BUCKET}
      - CLOUD_AWS_CREDENTIALS_ACCESS_KEY=${AWS_ACCESS_KEY_ID}
      - CLOUD_AWS_CREDENTIALS_SECRET_KEY=${AWS_SECRET_ACCESS_KEY}
    networks:
      - skilledup

  task-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: task-service
    container_name: task-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8084
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${TASK_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - CLOUD_AWS_REGION_STATIC=${AWS_REGION}
      - CLOUD_AWS_S3_BUCKET=${AWS_BUCKET}
      - CLOUD_AWS_CREDENTIALS_ACCESS_KEY=${AWS_ACCESS_KEY_ID}
      - CLOUD_AWS_CREDENTIALS_SECRET_KEY=${AWS_SECRET_ACCESS_KEY}
    networks:
      - skilledup

  notification-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: notification-service
    container_name: notification-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8085
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${NOTIFICATION_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
    networks:
      - skilledup

  support-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: support-service
    container_name: support-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8086
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${SUPPORT_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
    networks:
      - skilledup

  course-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: course-service
    container_name: course-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8090
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${COURSE_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - CLOUD_AWS_REGION_STATIC=${AWS_REGION}
      - CLOUD_AWS_S3_BUCKET=${AWS_BUCKET}
      - CLOUD_AWS_CREDENTIALS_ACCESS_KEY=${AWS_ACCESS_KEY_ID}
      - CLOUD_AWS_CREDENTIALS_SECRET_KEY=${AWS_SECRET_ACCESS_KEY}
    networks:
      - skilledup

  payment-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: payment-service
    container_name: payment-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8091
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${PAYMENT_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
    networks:
      - skilledup

  career-service:
    build:
      context: ..
      dockerfile: Dockerfile.backend
      args:
        MODULE: career-service
    container_name: career-service
    restart: unless-stopped
    depends_on:
      - eureka-server
    environment:
      - SERVER_PORT=8093
      - EUREKA_CLIENT_SERVICEURL_DEFAULTZONE=http://eureka-server:8761/eureka/
      - SPRING_DATASOURCE_URL=${CAREER_DB_URL}
      - SPRING_DATASOURCE_USERNAME=${DB_USERNAME}
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
      - CLOUD_AWS_REGION_STATIC=${AWS_REGION}
      - CLOUD_AWS_S3_BUCKET=${AWS_BUCKET}
      - CLOUD_AWS_CREDENTIALS_ACCESS_KEY=${AWS_ACCESS_KEY_ID}
      - CLOUD_AWS_CREDENTIALS_SECRET_KEY=${AWS_SECRET_ACCESS_KEY}
    networks:
      - skilledup

networks:
  skilledup:
    driver: bridge
